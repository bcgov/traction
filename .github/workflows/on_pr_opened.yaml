name: Install/upgrade PR Instance
on:
  pull_request:
    branches:
      - develop
    paths:
      - 'services/traction/**'
      - 'services/showcase/**'
      - 'charts/traction/**'
      - 'charts/showcase/**'
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review
      
jobs:
        
  run_integration_tests:
    name: 'Run Integration Tests on PR'
    runs-on: ubuntu-20.04
    steps:      
      - uses: actions/checkout@v2        
      - name: Build service
        uses: ./.github/actions/run_integration_tests
  
  # deploymenturls:
  #   name: Deployment URLs comment
  #   runs-on: ubuntu-20.04
  #   needs: 
  #     - deploy
  #   if: ${{ (fromJSON(needs.ready.outputs.deploy) == true) && !(contains(needs.*.result, 'failure')) }}
  #   steps:  
  #     - uses: actions/checkout@v2 
      
  #     - name: Find Comment
  #       uses: peter-evans/find-comment@v1
  #       id: fc
  #       with:
  #         issue-number: ${{ github.event.number }}
  #         comment-author: 'github-actions[bot]'
  #         body-includes: Deployment URLs ready for review. 
        
  #     - name: Create comment
  #       if: steps.fc.outputs.comment-id == ''
  #       uses: peter-evans/create-or-update-comment@v1
  #       with:
  #         issue-number: ${{ github.event.number }}
  #         body: |
  #           | Deployment | Resource | Location |
  #           | --- | --- | --- |
  #           | Traction | | 
  #           | | API | https://pr-${{ github.event.number }}-traction-api-dev.apps.silver.devops.gov.bc.ca |
  #           | | Innkeeper Swagger | https://pr-${{ github.event.number }}-traction-api-dev.apps.silver.devops.gov.bc.ca/innkeeper/docs |
  #           | | Tenant Swagger | https://pr-${{ github.event.number }}-traction-api-dev.apps.silver.devops.gov.bc.ca/tenant/docs |
  #           | Showcase | | |
  #           | | App | https://pr-${{ github.event.number }}-showcase-app-dev.apps.silver.devops.gov.bc.ca |
  #           | | Swagger | https://pr-${{ github.event.number }}-showcase-app-dev.apps.silver.devops.gov.bc.ca/api/docs |
  #           | Aca-Py | | |
  #           | | Admin Swagger | https://pr-${{ github.event.number }}-traction-acapy-admin-dev.apps.silver.devops.gov.bc.ca/api/doc |
            
  #           Deployment URLs ready for review.
